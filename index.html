<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RDS TEAM - Verified</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase Modules -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
      import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, increment, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
      import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

      window.fb = { initializeApp, getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, increment, collection, addDoc, serverTimestamp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken };
    </script>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background-color: #050810; font-family: 'Inter', sans-serif; color: #f8fafc; overflow: hidden; margin: 0; user-select: none; }
        
        @keyframes fillProgress { 0% { width: 0%; } 100% { width: 100%; } }
        .loading-bar-fill { height: 100%; background: linear-gradient(90deg, #dc2626, #2563eb, #7c3aed); animation: fillProgress 3.5s linear forwards; }
        .nav-blur { backdrop-filter: blur(20px); background: rgba(10, 15, 30, 0.8); }
        ::-webkit-scrollbar { display: none; }
        .animate-up { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDb_2_4r89AhNKceMJ80HvX-MOgSlcUegY",
            authDomain: "earning-ai-guide.firebaseapp.com",
            databaseURL: "https://earning-ai-guide-default-rtdb.firebaseio.com",
            projectId: "earning-ai-guide",
            storageBucket: "earning-ai-guide.firebasestorage.app",
            messagingSenderId: "856725361260",
            appId: "1:856725361260:web:f3248390c3db55f65c3e49"
        };

        const BOT_USERNAME = "earning_ai_guide_bot";
        // Unique App ID for Firestore path
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'rds-team-official-v11'; 

        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            const [activeTab, setActiveTab] = useState('home');
            const [payoutAmount, setPayoutAmount] = useState('');
            const [payoutMethod, setPayoutMethod] = useState('bKash');
            const [payoutAddress, setPayoutAddress] = useState('');
            
            const isInitialized = useRef(false);

            useEffect(() => {
                if (isInitialized.current) return;
                isInitialized.current = true;

                const { initializeApp, getFirestore, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, doc, setDoc, onSnapshot } = window.fb;
                
                const firebase_config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
                const app = initializeApp(firebase_config);
                const db = getFirestore(app);
                const auth = getAuth(app);

                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (err) { 
                        console.error("Auth Error:", err);
                        // Fallback if anonymous is restricted
                    }
                };
                initAuth();

                const unsubscribeAuth = onAuthStateChanged(auth, (currUser) => {
                    if (currUser) {
                        setUser(currUser);
                        // RULE 1: Strict Paths
                        const profileRef = doc(db, 'artifacts', APP_ID, 'users', currUser.uid, 'data', 'profile');
                        
                        const unsubscribeProfile = onSnapshot(profileRef, async (snapshot) => {
                            if (snapshot.exists()) {
                                setProfile(snapshot.data());
                            } else {
                                const referrerId = tg.initDataUnsafe?.start_param || null;
                                const initialData = {
                                    uid: currUser.uid,
                                    name: tg.initDataUnsafe?.user?.first_name || "User",
                                    balance: 0.50,
                                    clicks: 0,
                                    referrals: 0,
                                    photo: tg.initDataUnsafe?.user?.photo_url || null,
                                    joinedAt: serverTimestamp()
                                };
                                await setDoc(profileRef, initialData);

                                if (referrerId && referrerId !== currUser.uid) {
                                    const refProfileRef = doc(db, 'artifacts', APP_ID, 'users', referrerId, 'data', 'profile');
                                    // Use a try-catch for referrer update in case the ID is invalid
                                    try {
                                        await updateDoc(refProfileRef, {
                                            balance: window.fb.increment(0.10),
                                            referrals: window.fb.increment(1)
                                        });
                                    } catch(e) {}
                                }
                            }
                        }, (error) => console.error("Firestore Error:", error));

                        return () => unsubscribeProfile();
                    }
                });

                const timer = setTimeout(() => setLoading(false), 4000);
                return () => {
                    unsubscribeAuth();
                    clearTimeout(timer);
                };
            }, []);

            const handleAdClick = async () => {
                if (!user) return;
                const { getFirestore, doc, updateDoc, increment } = window.fb;
                const db = getFirestore();
                const profileRef = doc(db, 'artifacts', APP_ID, 'users', user.uid, 'data', 'profile');
                try {
                    await updateDoc(profileRef, {
                        balance: increment(0.005),
                        clicks: increment(1)
                    });
                } catch(e) { console.error("Click error:", e); }
            };

            const handlePayout = async () => {
                if (!user || !profile) return;
                const amount = parseFloat(payoutAmount);
                if (isNaN(amount) || amount < 5) return alert("Minimum $5 required");
                if (amount > profile.balance) return alert("Insufficient balance");
                if (!payoutAddress) return alert("Please enter wallet address");
                
                const { getFirestore, collection, addDoc, serverTimestamp, doc, updateDoc, increment } = window.fb;
                const db = getFirestore();
                
                try {
                    await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'payouts'), {
                        uid: user.uid,
                        amount,
                        method: payoutMethod,
                        address: payoutAddress,
                        status: 'pending',
                        timestamp: serverTimestamp()
                    });

                    const profileRef = doc(db, 'artifacts', APP_ID, 'users', user.uid, 'data', 'profile');
                    await updateDoc(profileRef, { balance: increment(-amount) });
                    
                    alert("উইথড্র রিকোয়েস্ট পাঠানো হয়েছে!");
                    setPayoutAmount('');
                    setPayoutAddress('');
                } catch(e) { alert("Error: " + e.message); }
            };

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-[#050810]">
                    <Icon name="heart" size={90} className="text-red-600 fill-red-600 animate-pulse mb-8" />
                    <h1 className="text-4xl font-black tracking-widest text-white italic">RDS TEAM</h1>
                    <div className="w-64 h-1.5 bg-slate-900 rounded-full mt-4 overflow-hidden border border-white/5">
                        <div className="loading-bar-fill"></div>
                    </div>
                    <p className="mt-6 text-[10px] text-slate-500 uppercase tracking-[0.5em] font-bold">Secure Connection...</p>
                </div>
            );

            return (
                <div className="flex flex-col h-screen">
                    <header className="px-6 py-5 flex justify-between items-center bg-slate-900/50 border-b border-white/5">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold">R</div>
                            <span className="font-black italic text-xl">RDS TEAM</span>
                        </div>
                        <div className="w-10 h-10 rounded-full border-2 border-blue-500/20 overflow-hidden">
                            {profile?.photo ? <img src={profile.photo} className="w-full h-full object-cover" alt="profile" /> : <div className="w-full h-full bg-blue-600 flex items-center justify-center font-bold">{profile?.name?.[0]}</div>}
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-6 pb-32">
                        {activeTab === 'home' && (
                            <div className="space-y-6 animate-up">
                                <div className="bg-gradient-to-br from-blue-600 to-indigo-900 p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden">
                                    <Icon name="wallet" size={100} className="absolute -right-4 -top-4 opacity-10" />
                                    <p className="text-white/70 text-[10px] font-bold uppercase tracking-widest">Main Balance</p>
                                    <h2 className="text-5xl font-black mt-1">${profile?.balance?.toFixed(3)}</h2>
                                </div>

                                <button onClick={handleAdClick} className="w-full bg-slate-900 border border-blue-500/20 p-6 rounded-[2.5rem] flex items-center justify-between active:scale-95 transition-all">
                                    <div className="flex items-center gap-4 text-left">
                                        <div className="p-4 bg-blue-500/10 rounded-2xl text-blue-500"><Icon name="play" size={28} /></div>
                                        <div><h4 className="font-bold text-lg">Watch Ads</h4><p className="text-[10px] text-slate-500 font-bold uppercase">Earn $0.005 Per Ad</p></div>
                                    </div>
                                    <Icon name="chevron-right" className="text-slate-700" />
                                </button>

                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-slate-900/50 p-6 rounded-3xl border border-white/5 text-center">
                                        <p className="text-[10px] text-slate-500 font-bold uppercase">Clicks</p>
                                        <p className="text-2xl font-black">{profile?.clicks}</p>
                                    </div>
                                    <div className="bg-slate-900/50 p-6 rounded-3xl border border-white/5 text-center">
                                        <p className="text-[10px] text-slate-500 font-bold uppercase">Refers</p>
                                        <p className="text-2xl font-black">{profile?.referrals}</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'payout' && (
                            <div className="space-y-6 animate-up">
                                <h3 className="text-2xl font-black italic">PAY OUT</h3>
                                <div className="bg-slate-900 p-8 rounded-[2.5rem] border border-blue-500/10">
                                    <div className="mb-6"><p className="text-[10px] font-bold text-slate-500 uppercase">Available</p><h2 className="text-4xl font-black text-blue-500">${profile?.balance?.toFixed(2)}</h2></div>
                                    <div className="space-y-4">
                                        <select value={payoutMethod} onChange={e=>setPayoutMethod(e.target.value)} className="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none font-bold">
                                            <option value="bKash">bKash (Personal)</option>
                                            <option value="Nagad">Nagad (Personal)</option>
                                            <option value="Binance">Binance (USDT)</option>
                                        </select>
                                        <input type="number" placeholder="Amount ($)" value={payoutAmount} onChange={e=>setPayoutAmount(e.target.value)} className="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none font-bold" />
                                        <input type="text" placeholder="Wallet Address" value={payoutAddress} onChange={e=>setPayoutAddress(e.target.value)} className="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none font-bold" />
                                        <button onClick={handlePayout} className="w-full bg-blue-600 py-5 rounded-[2rem] font-black shadow-lg shadow-blue-900/20 active:scale-95 transition-all">Request Payout</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'refer' && (
                            <div className="space-y-6 text-center animate-up">
                                <Icon name="users" size={80} className="mx-auto text-indigo-500 mb-2 p-4 bg-indigo-500/10 rounded-3xl" />
                                <h3 className="text-3xl font-black italic">REFER & EARN</h3>
                                <div className="bg-slate-900 p-8 rounded-[2.5rem] border border-slate-800">
                                    <p className="text-[10px] text-slate-400 mb-4 uppercase font-bold tracking-widest">Your Referral Link</p>
                                    <div className="bg-black/40 p-4 rounded-2xl border border-white/5 truncate text-[10px] font-mono text-blue-400">t.me/{BOT_USERNAME}/app?startapp={user?.uid}</div>
                                    <button onClick={() => { navigator.clipboard.writeText(`https://t.me/${BOT_USERNAME}/app?startapp=${user?.uid}`); alert("Link Copied!"); }} className="w-full mt-4 bg-indigo-600 py-4 rounded-2xl font-bold">Copy Link</button>
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'history' && <div className="text-center py-20 text-slate-600 uppercase font-black text-xs">No History Available</div>}
                        
                        {activeTab === 'profile' && (
                            <div className="space-y-6 animate-up">
                                <div className="bg-slate-900 p-10 rounded-[3rem] text-center border border-white/5">
                                    <div className="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-blue-600/20 overflow-hidden shadow-2xl">
                                        {profile?.photo ? <img src={profile.photo} className="w-full h-full object-cover" alt="profile" /> : <div className="w-full h-full bg-blue-600 flex items-center justify-center text-3xl font-bold">{profile?.name?.[0]}</div>}
                                    </div>
                                    <h4 className="text-2xl font-black">{profile?.name}</h4>
                                    <p className="text-slate-500 text-[10px] font-bold uppercase mt-1">ID: {user?.uid?.substring(0,8)}</p>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 nav-blur border-t border-white/5 p-4 pb-10 flex justify-around items-end z-50">
                        <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1 ${activeTab === 'home' ? 'text-blue-500 scale-110' : 'text-slate-500'}`}><Icon name="home" /><span className="text-[8px] font-black uppercase">Home</span></button>
                        <button onClick={() => setActiveTab('refer')} className={`flex flex-col items-center gap-1 ${activeTab === 'refer' ? 'text-blue-500 scale-110' : 'text-slate-500'}`}><Icon name="users" /><span className="text-[8px] font-black uppercase">Refer</span></button>
                        <button onClick={() => setActiveTab('payout')} className="relative -top-6"><div className={`w-14 h-14 rounded-full flex items-center justify-center shadow-2xl transition-all ${activeTab === 'payout' ? 'bg-blue-600 rotate-12 scale-110' : 'bg-slate-800'}`}><Icon name="wallet" className="text-white" size={24} /></div></button>
                        <button onClick={() => setActiveTab('history')} className={`flex flex-col items-center gap-1 ${activeTab === 'history' ? 'text-blue-500 scale-110' : 'text-slate-500'}`}><Icon name="history" /><span className="text-[8px] font-black uppercase">History</span></button>
                        <button onClick={() => setActiveTab('profile')} className={`flex flex-col items-center gap-1 ${activeTab === 'profile' ? 'text-blue-500 scale-110' : 'text-slate-500'}`}><Icon name="user" /><span className="text-[8px] font-black uppercase">Profile</span></button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>